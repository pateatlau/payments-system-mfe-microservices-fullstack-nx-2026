# MFE POC-2 - Cursor Rules

> **Phase:** POC-2 Only | **Reference:** `docs/POC-2-Implementation/project-rules-cursor.md` for detailed rules

---

## üö® Critical Rules

1. **NO throw-away code** - Must carry forward to Production
2. **Never use `any` type** - Documented exceptions only
3. **Always use Tailwind v4 syntax** - Never v3 (CRITICAL)
4. **Fix type errors immediately** - Don't work around them
5. **Write tests alongside code** - 70% coverage minimum
6. **POC-2 scope only** - Real backend integration, JWT auth, event bus, design system, Admin MFE
7. **DO NOT automatically perform additional tasks** - Only perform tasks explicitly requested. If a related task seems helpful, ask for confirmation with a clear description before proceeding.
8. **üö® MANDATORY: Update BOTH documentation files IMMEDIATELY after ANY task/sub-task completion:**
   - Update `docs/POC-2-Implementation/task-list.md`: Mark checkboxes `[x]`, set Status "‚úÖ Complete", add date, add notes
   - Update `docs/POC-2-Implementation/implementation-plan.md`: Mark ALL verification checkboxes `[x]`, mark ALL acceptance criteria ‚úÖ, set Status "‚úÖ Complete", add date, add comprehensive notes, update Files Created section
   - **NON-NEGOTIABLE** - Must be done immediately, before moving to next task. NEVER skip or defer.

---

## POC-2 Scope

**In Scope:** Real backend API integration, JWT auth, event bus, Admin MFE (Port 4203), design system (Tailwind v4 + shadcn/ui), RBAC (ADMIN/CUSTOMER/VENDOR), API client library, backend services (API Gateway, Auth, Payments, Admin, Profile, Event Hub), PostgreSQL + Prisma, Redis Pub/Sub, error handling, basic observability

**NOT in Scope:** Real PSP integration (stubbed at backend), advanced infrastructure, separate DBs per service, WebSocket, advanced performance optimizations (all POC-3)

---

## Tech Stack

**Frontend:** React 19.2.0, Nx, Rspack (HMR + Module Federation v2), React Router 7.x, Zustand 4.5.x, TanStack Query 5.x, React Hook Form 7.52.x + Zod 3.23.x, Tailwind CSS 4.0+ (CRITICAL: v4 syntax only), shadcn/ui, Axios 1.7.x, Jest 30.x + React Testing Library 16.1.x, Playwright, pnpm 9.x, TypeScript 5.9.x (strict)

**Backend:** Node.js 24.11.x LTS, Express, PostgreSQL, Prisma ORM, Redis, JWT

---

## Code Rules

**TypeScript:** Strict mode, no `any`, explicit return types, `interface` for objects, `type` for unions, fix errors immediately

**React:** Functional components only, hooks for state, explicit props interfaces, PascalCase components, camelCase hooks with `use` prefix

**File Organization:** One component per file, tests alongside (`*.test.tsx`), index files for exports

**Naming:** Components: PascalCase | Hooks: camelCase with `use` | Functions: camelCase | Constants: UPPER_SNAKE_CASE | Types: PascalCase

---

## Architecture Patterns

**Authentication:** Real JWT with backend Auth Service (no mock), store in Zustand (`libs/shared-auth-store`), shared API client with interceptors, token refresh, RBAC helpers (hasRole, hasAnyRole), secure storage. Roles: `ADMIN` (full access, Admin MFE), `CUSTOMER` (payments, own history), `VENDOR` (initiate payments, reports)

**Routing:** React Router 7.x, configure in shell app, `ProtectedRoute` component. Routes: `/` (redirect), `/signin`, `/signup`, `/payments` (protected), `/admin` (protected, ADMIN only)

**State Management:**

- **Zustand:** Client-side state (auth, UI, theme) within single MFEs only, persist middleware for auth, use event bus for inter-MFE communication
- **TanStack Query:** Server state (API data, caching) with real backend APIs, configure staleTime/cacheTime, use shared API client
- **Event Bus:** Decoupled inter-MFE communication, replace shared Zustand stores, implement `libs/shared-event-bus`, define event types/contracts

**Payments:** CRITICAL - Operations stubbed at backend level (no PSP). Use real backend Payments Service API, TanStack Query hooks, shared API client, document stubbing

**Forms & Validation:** React Hook Form + Zod, passwords 12+ chars (banking-grade: uppercase, lowercase, numbers, symbols)

**Styling:** Tailwind CSS 4.0+ (CRITICAL: v4 syntax only, never v3), use shadcn/ui design system components, follow design system patterns

**Design System:** shadcn/ui components, `libs/shared-design-system` library, Tailwind v4, follow shadcn/ui patterns, document usage, replace inline components

**Module Federation v2:** Shared dependencies (react, react-dom as singletons), React.lazy() + Suspense. Shell remotes: `authMfe:4201`, `paymentsMfe:4202`, `adminMfe:4203`. Exposes: Auth (`./SignIn`, `./SignUp`), Payments (`./PaymentsPage`), Admin (`./AdminDashboard`)

**Backend Integration:**

- **API Client:** `libs/shared-api-client`, Axios with JWT interceptors, error handling/retry, base URL from env, auto token refresh
- **Backend Services:** API Gateway integration, REST API endpoints, follow API contracts, handle auth errors, proper error handling

---

## Project Structure

```
apps/ ‚Üí shell (4200), auth-mfe (4201), payments-mfe (4202), admin-mfe (4203)
libs/ ‚Üí shared-utils, shared-ui, shared-types, shared-auth-store, shared-header-ui,
        shared-api-client (NEW), shared-event-bus (NEW), shared-design-system (NEW)
```

---

## Task Management & Documentation

**AI Assistant:** Only perform explicitly requested tasks. Ask for confirmation before additional related tasks.

**Task Progression:**

- Follow `docs/POC-2-Implementation/implementation-plan.md` for steps
- **üö® MANDATORY:** After EACH task/sub-task, update BOTH `task-list.md` AND `implementation-plan.md` (see Critical Rule #8)
- Ask user confirmation before next task
- Show completed task summary and next task details

**Task Completion Checklist (MANDATORY):**

- ‚úÖ Task completed per implementation plan
- ‚úÖ Verification checklist items completed
- ‚úÖ Acceptance criteria met
- ‚úÖ `task-list.md` updated (checkboxes `[x]`, Status "‚úÖ Complete", date, notes)
- ‚úÖ `implementation-plan.md` updated (ALL verification checkboxes `[x]`, ALL acceptance criteria ‚úÖ, Status "‚úÖ Complete", date, comprehensive notes, Files Created section)
- ‚úÖ Both files synchronized (same status, date, consistent notes)
- ‚úÖ User confirmation obtained

**Package.json Scripts:** Add commands when creating features/apps/libs, follow `feature:project` naming, include individual + aggregate commands

**Git Commits:** Ask for confirmation, show message/files, commit after major phases, only after updating both documentation files, commit before asking to proceed

**Rspack Migration Docs:** Update both `task-list.md` and `rspack-migration-plan.md`, keep synchronized, update phase percentages and status

---

## Testing Requirements

**Unit:** Write alongside code, 70%+ coverage, test components/stores/hooks/API clients, Jest + React Testing Library

**Integration:** Auth flow, payments flow, route protection, event bus, RBAC, API interceptors, token refresh

**E2E:** Playwright, critical journeys, sign-in/sign-up, payments, logout, RBAC, Admin MFE, event bus

---

## Before Committing

‚úÖ TypeScript compiles | ‚úÖ ESLint passes | ‚úÖ Tests pass | ‚úÖ Build works | ‚úÖ No `any` types | ‚úÖ Tests written | ‚úÖ Module Federation works | ‚úÖ Tailwind v4 syntax | ‚úÖ Real JWT auth works | ‚úÖ Backend API integration works | ‚úÖ Event bus works | ‚úÖ Design system components used

---

## Success Criteria

‚úÖ All MFEs run (4200, 4201, 4202, 4203) | ‚úÖ React Router 7 works | ‚úÖ Real JWT auth works | ‚úÖ Event bus works | ‚úÖ TanStack Query with backend APIs | ‚úÖ Tailwind v4 works | ‚úÖ Design system works | ‚úÖ Route protection works | ‚úÖ RBAC works | ‚úÖ Universal header displays | ‚úÖ Tests pass (70% coverage) | ‚úÖ Remotes load dynamically | ‚úÖ Backend services integrated | ‚úÖ API client works

---

## Common Pitfalls

‚ùå **üö® CRITICAL:** Forgetting to update `task-list.md` and `implementation-plan.md` - MANDATORY  
‚ùå Using `any` type | ‚ùå Throw-away code | ‚ùå Ignoring TypeScript errors | ‚ùå Tailwind v3 syntax (must use v4) | ‚ùå Skipping tests | ‚ùå Breaking patterns | ‚ùå Not following structure | ‚ùå Hardcoding values | ‚ùå Circular dependencies | ‚ùå Mixing concerns | ‚ùå Mock auth (use real JWT) | ‚ùå Frontend stubbed APIs (use backend) | ‚ùå Shared Zustand across MFEs (use event bus) | ‚ùå Not using design system | ‚ùå Not using shared API client | ‚ùå Real PSP integration | ‚ùå Deferring documentation updates

---

**For detailed rules, examples, and guidance:** See `docs/POC-2-Implementation/project-rules-cursor.md`
