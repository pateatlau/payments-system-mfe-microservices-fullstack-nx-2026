# MFE POC-1 - Cursor Rules

> **Phase:** POC-1 Only | **Reference:** `docs/POC-1-Implementation/project-rules-cursor.md` for detailed rules

---

## üö® Critical Rules

1. **NO throw-away code** - Must carry forward to Production
2. **Never use `any` type** - Documented exceptions only
3. **Always use Tailwind v4 syntax** - Never v3 (CRITICAL)
4. **Fix type errors immediately** - Don't work around them
5. **Write tests alongside code** - 70% coverage minimum
6. **POC-1 scope only** - Mock auth, stubbed payments (no actual PSP), no backend
7. **DO NOT automatically perform additional tasks** - Only perform tasks explicitly requested in the prompt. If a related task seems helpful, ask for confirmation with a clear description of what you want to implement before proceeding.

---

## POC-1 Scope

**In Scope:**

- Authentication system (Auth MFE, Port 4201) with mock authentication
- Payments system (Payments MFE, Port 4202) with stubbed operations (no actual PSP)
- Routing (React Router 7)
- State management (Zustand + TanStack Query)
- Styling (Tailwind CSS v4)
- Role-based access control (RBAC) - VENDOR and CUSTOMER roles
- Universal header component
- Form validation (React Hook Form + Zod)
- Route protection

**NOT in Scope:**

- ‚ùå Real authentication backend (POC-2)
- ‚ùå Event bus for inter-MFE communication (POC-2)
- ‚ùå Real payment processing with PSP integration (MVP/Production - all POC phases use stubbed payments)
- ‚ùå Design system (POC-2)
- ‚ùå Backend integration (POC-2)

---

## Tech Stack (POC-1)

- **React:** 19.2.0 (match React DOM)
- **Nx:** Latest
- **Vite:** 6.x
- **Module Federation:** @module-federation/enhanced 0.21.6 (BIMF)
- **Routing:** React Router 7.x
- **State (Client):** Zustand 4.5.x
- **State (Server):** TanStack Query 5.x
- **Forms:** React Hook Form 7.52.x + Zod 3.23.x
- **Styling:** Tailwind CSS 4.0+ - **CRITICAL: Always use v4 syntax, never v3**
- **HTTP Client:** Axios 1.7.x (for future backend integration)
- **Error Handling:** react-error-boundary 4.0.13
- **Testing:** Vitest 2.0.x, React Testing Library 16.1.x, Playwright
- **Package Manager:** pnpm 9.x
- **TypeScript:** 5.9.x (strict mode)

---

## Code Rules

### TypeScript

- **MUST:** Strict mode, no `any`, explicit return types, `interface` for objects, `type` for unions
- **MUST:** Fix type errors immediately

### React

- **MUST:** Functional components only, hooks for state, explicit props interfaces
- **MUST:** PascalCase components (`SignIn.tsx`), camelCase hooks with `use` prefix

### File Organization

- **MUST:** One component per file, tests alongside (`*.test.tsx`), index files for exports

### Naming

- Components: PascalCase | Hooks: camelCase with `use` | Functions: camelCase | Constants: UPPER_SNAKE_CASE | Types: PascalCase

---

## Authentication & Authorization

### Mock Authentication

- **MUST:** Use mock authentication (no real backend in POC-1)
- **MUST:** Store auth state in Zustand store (`libs/shared-auth-store`)
- **MUST:** Use localStorage for persistence
- **MUST:** Implement RBAC helpers (hasRole, hasAnyRole)

**User Roles:**

- `ADMIN` - Full system access (functionality in POC-2)
- `CUSTOMER` - Can make payments, view own history
- `VENDOR` - Can initiate payments, view reports

## Routing (React Router 7)

- **MUST:** Use React Router 7.x
- **MUST:** Configure routes in shell app
- **MUST:** Implement route protection with `ProtectedRoute` component
- **Routes:** `/` (redirect), `/signin`, `/signup`, `/payments` (protected)

## State Management

### Zustand (Client State)

- **MUST:** Use Zustand for client-side state (auth, UI, theme)
- **MUST:** Share auth store between MFEs (acceptable for POC-1)
- **MUST:** Use persist middleware for auth state

### TanStack Query (Server State)

- **MUST:** Use TanStack Query for server-side state (API data, caching)
- **MUST:** Use with stubbed payment APIs (no actual PSP)
- **MUST:** Configure query options (staleTime, cacheTime)

## Payments System

### Stubbed Payment Operations

**CRITICAL: All payment operations are stubbed (no actual PSP integration):**

- **MUST:** Create stubbed payment APIs (no actual PSP)
- **MUST:** Document that operations are stubbed
- **MUST:** Use TanStack Query hooks with stubbed APIs
- **MUST NOT:** Integrate with real Payment Service Provider

## Forms & Validation

- **MUST:** Use React Hook Form for all forms
- **MUST:** Use Zod for validation schemas
- **MUST:** Minimum 12 characters for passwords (banking-grade)
- **MUST:** Complexity requirements (uppercase, lowercase, numbers, symbols)

## Styling (Tailwind CSS v4)

**CRITICAL: Always use Tailwind v4 syntax, never v3:**

- **MUST:** Use Tailwind CSS 4.0+
- **MUST:** Use inline utility classes (POC-1)
- **MUST NOT:** Use v3 syntax
- **MUST NOT:** Use design system components yet (POC-2)

## Module Federation v2

- **MUST:** Configure shared dependencies (react, react-dom as singletons)
- **MUST:** Use React.lazy() + Suspense for dynamic loading
- **Shell:** `remotes: { authMfe: 'http://localhost:4201/assets/remoteEntry.js', paymentsMfe: 'http://localhost:4202/assets/remoteEntry.js' }`
- **Auth MFE:** `exposes: { './SignIn': './src/components/SignIn.tsx', './SignUp': './src/components/SignUp.tsx' }`
- **Payments MFE:** `exposes: { './PaymentsPage': './src/components/PaymentsPage.tsx' }`

---

## Project Structure

```
apps/
‚îú‚îÄ‚îÄ shell/              # Host (Port 4200) - Updated with routing, header
‚îú‚îÄ‚îÄ auth-mfe/           # Remote (Port 4201) - NEW
‚îî‚îÄ‚îÄ payments-mfe/       # Remote (Port 4202) - NEW
libs/
‚îú‚îÄ‚îÄ shared-utils/       # Existing
‚îú‚îÄ‚îÄ shared-ui/          # Existing
‚îú‚îÄ‚îÄ shared-types/       # Existing (extended)
‚îú‚îÄ‚îÄ shared-auth-store/  # NEW - Zustand auth store
‚îî‚îÄ‚îÄ shared-header-ui/   # NEW - Universal header component
```

---

## Nx Commands

- `nx serve shell` / `nx serve auth-mfe` / `nx serve payments-mfe`
- `nx run-many --target=serve --projects=shell,auth-mfe,payments-mfe --parallel`
- `nx build <project>` / `nx test <project>` / `nx lint <project>`
- `nx generate @nx/react:application <name> --bundler=vite`
- `nx generate @nx/react:library <name> --bundler=vite`
- `nx generate @nx/js:library <name> --bundler=tsc`

---

## Git & Documentation Rules

### Git Commits

- **MUST:** Ask for user confirmation before making any git commits
- **MUST:** Show commit message and changed files before committing
- **MUST NOT:** Commit automatically without explicit user approval
- **MUST:** Perform a git commit after completing each major/top-level phase (e.g., Phase 1, Phase 2, etc.)
- **MUST:** Commit only after verifying everything works and updating status in both `task-list.md` and `implementation-plan.md`
- **MUST:** For Rspack migration, update both `docs/Rspack-Migration/task-list.md` and `docs/Rspack-Migration/rspack-migration-plan.md` before committing
- **MUST:** Commit before asking user whether to proceed to the next phase

### Documentation Files

- **MUST:** Create documentation files in `docs/POC-1-Implementation/` folder
- **MUST:** Update both `task-list.md` and `implementation-plan.md` after each task
- **MUST:** Ask for confirmation if documentation location is unclear

### Rspack Migration Documentation

- **MUST:** Update both `docs/Rspack-Migration/task-list.md` AND `docs/Rspack-Migration/rspack-migration-plan.md` after completing:
  - Top-level tasks (Phase 1, Phase 2, etc.) - update phase status and completion percentage
  - Sub-tasks (Task 1.1, 1.2, 2.1, etc.) - mark checkboxes, update status, add notes, update acceptance criteria
- **MUST:** Keep both files synchronized - same completion status, same notes, same dates
- **MUST:** Update phase completion percentages in task-list.md
- **MUST:** Update document header status and "Next Steps" section in rspack-migration-plan.md

---

## Task Management & Workflow

### AI Assistant Behavior

- **MUST NOT:** Automatically perform additional tasks apart from what is explicitly requested in the prompt
- **MUST:** If a related task seems helpful, ask for confirmation with a clear description of what you want to implement before proceeding
- **MUST:** Only perform tasks that are explicitly requested or confirmed by the user

### Task Progression

- **MUST:** Follow `docs/POC-1-Implementation/implementation-plan.md` for detailed task steps
- **MUST:** Update `docs/POC-1-Implementation/task-list.md` after completing each task/sub-task
- **MUST:** Update `docs/POC-1-Implementation/implementation-plan.md` after completing each task/sub-task (mark verification checkboxes and update status)
- **MUST:** Ask for user confirmation before proceeding to the next task after completing each task or sub-task
- **MUST:** Show completed task summary and next task details when asking for confirmation
- **MUST NOT:** Automatically proceed to next task without explicit user approval

### Package.json Scripts

- **MUST:** Add relevant commands to root `package.json` scripts section when creating new features, apps, libraries, or testing configurations
- **MUST:** Follow the existing naming convention: `feature:project` (e.g., `dev:shell`, `dev:auth-mfe`, `test:payments-mfe`)
- **MUST:** Include both individual project commands and aggregate commands (e.g., `dev` for all, `dev:shell` for one)
- **MUST:** Add affected commands when applicable (e.g., `build:affected`, `test:affected`)

### Task Completion Checklist

- ‚úÖ Task completed according to implementation plan
- ‚úÖ Verification checklist items completed
- ‚úÖ Acceptance criteria met
- ‚úÖ Task list updated with completion status (`task-list.md`)
- ‚úÖ Implementation plan updated with completion status (`implementation-plan.md`)
- ‚úÖ User confirmation obtained before next task

### Rspack Migration Task Completion Checklist

- ‚úÖ Task completed according to migration plan
- ‚úÖ Verification checklist items completed
- ‚úÖ Acceptance criteria met
- ‚úÖ `docs/Rspack-Migration/task-list.md` updated (checkboxes, status, notes, completion date)
- ‚úÖ `docs/Rspack-Migration/rspack-migration-plan.md` updated (checkboxes, status, notes, acceptance criteria)
- ‚úÖ Phase completion percentage updated in task-list.md
- ‚úÖ Document status and "Next Steps" updated in rspack-migration-plan.md
- ‚úÖ Both files synchronized (same status, same notes)

---

## Testing Requirements

### Unit Testing

- **MUST:** Write tests alongside code (not after)
- **MUST:** 70%+ test coverage target
- **MUST:** Test all components, stores, and hooks
- **MUST:** Use Vitest + React Testing Library

### Integration Testing

- **MUST:** Test authentication flow
- **MUST:** Test payments flow
- **MUST:** Test route protection
- **MUST:** Test state synchronization
- **MUST:** Test role-based access

### E2E Testing

- **MUST:** Use Playwright for E2E tests
- **MUST:** Test critical user journeys
- **MUST:** Test sign-in/sign-up flows
- **MUST:** Test payments flow
- **MUST:** Test logout flow
- **MUST:** Test role-based access

---

## Before Committing

‚úÖ TypeScript compiles | ‚úÖ ESLint passes | ‚úÖ Tests pass | ‚úÖ Build works | ‚úÖ No `any` types | ‚úÖ Tests written | ‚úÖ Module Federation works | ‚úÖ Tailwind v4 syntax | ‚úÖ Mock auth works | ‚úÖ Stubbed payments work

---

## Success Criteria

‚úÖ Auth MFE (4201) & Payments MFE (4202) run | ‚úÖ React Router 7 works | ‚úÖ Zustand stores shared | ‚úÖ TanStack Query works | ‚úÖ Tailwind CSS v4 works | ‚úÖ Route protection works | ‚úÖ RBAC works | ‚úÖ Universal header displays | ‚úÖ Tests pass (70% coverage) | ‚úÖ All remotes load dynamically

---

## Common Pitfalls to Avoid

- ‚ùå Using `any` type without justification
- ‚ùå Creating throw-away code
- ‚ùå Ignoring TypeScript errors
- ‚ùå Using Tailwind v3 syntax (must use v4)
- ‚ùå Skipping tests
- ‚ùå Breaking existing patterns
- ‚ùå Not following project structure
- ‚ùå Hardcoding values (use environment variables)
- ‚ùå Creating circular dependencies
- ‚ùå Mixing concerns (keep components, hooks, utilities separate)
- ‚ùå Using real PSP integration (must use stubbed operations)
- ‚ùå Using real backend authentication (must use mock auth)
- ‚ùå Using design system components (POC-2)

---

**For detailed rules, examples, and guidance:** See `docs/POC-1-Implementation/project-rules-cursor.md`
